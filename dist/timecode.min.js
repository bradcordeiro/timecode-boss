!function(s,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(s="undefined"!=typeof globalThis?globalThis:s||self)["timecode-boss"]=t()}(this,(function(){"use strict";const s=/(\d{1,2}):(\d{1,2}):(\d{1,2})(?:[.,](\d{1,3}))?/,t=/(\d{1,2})[:;](\d{1,2})[:;](\d{1,2})[:;](\d{1,2})/;class e{constructor(s,t=29.97){this.hours=0,this.minutes=0,this.seconds=0,this.frames=0,this.frameRate=t,s instanceof Date?this.setFieldsFromDate(s):"number"==typeof s?this.setFieldsFromFrameCount(s):"string"==typeof s?this.setFieldsFromString(s):"object"==typeof s&&(this.setFieldsFromObject(s),s.frameRate&&(this.frameRate=s.frameRate))}static isValidTimecodeString(s){return t.test(s)}setFieldsFromFrameCount(s){let t=s;this.setHours(Math.trunc(t/this.framesPerHour())),t-=this.framesInHoursField();const e=Math.trunc(t/this.framesPer10Minute());t-=this.framesPer10Minute()*e;const r=Math.trunc(t/this.framesPerMinute());this.setMinutes(10*e+r),t-=r*this.framesPerMinute(),this.setSeconds(Math.trunc(t/this.nominalFrameRate())),t-=this.framesInSecondsField(),this.setFrames(t)}setFieldsFromString(e){let r=t.exec(e);if(r&&5===r.length){const[,s,t,e,i]=r,n=parseInt(s,10),a=parseInt(t,10),o=parseInt(e,10),h=parseInt(i,10);return this.setFieldsFromObject({hours:n,minutes:a,seconds:o,frames:h})}if(r=s.exec(e),r&&r.length>=4){const[,s,t,e,i]=r,n=i||0,a=parseInt(s,10),o=parseInt(t,10),h=parseInt(e,10),m=parseFloat(`0.${n}`);return this.setFieldsFromObject({hours:a,minutes:o,seconds:h,frames:this.getFramesFromMilliseconds(m)})}throw new TypeError(`Invalid timecode string ${e}`)}setFieldsFromObject(s){return s.hours&&(this.hours=s.hours),s.minutes&&(this.minutes=s.minutes),s.seconds&&(this.seconds=s.seconds),s.frames&&(this.frames=s.frames),s.hours&&this.setHours(s.hours),s.minutes&&this.setMinutes(s.minutes),s.seconds&&this.setSeconds(s.seconds),s.frames&&this.setFrames(s.frames),this}setFieldsFromDate(s){return this.setFieldsFromObject({hours:s.getHours(),minutes:s.getMinutes(),seconds:s.getSeconds(),frames:this.getFramesFromMilliseconds(s.getMilliseconds())})}getFramesFromMilliseconds(s){let t=s;for(;t>1||t<-1;)t/=10;return Math.trunc(t*this.nominalFrameRate())}framesPerHour(){return 6*this.framesPer10Minute()}framesPer10Minute(){return 10*this.framesPerMinute()+this.framesToDrop()}framesPerMinute(){return 60*this.nominalFrameRate()-this.framesToDrop()}milliseconds(){return this.frames/this.nominalFrameRate()}framesToDrop(){return this.isDropFrame()?this.nominalFrameRate()/15:0}incrementIfDropFrame(){this.isDropFrame()&&this.frames<2&&0===this.seconds&&this.minutes%10!=0&&(this.frames+=2)}separator(){return this.isDropFrame()?";":":"}framesInHoursField(){return this.hours*this.framesPerHour()}framesInMinutesField(){return Math.trunc(this.minutes/10)*this.framesPer10Minute()+this.minutes%10*this.framesPerMinute()}framesInSecondsField(){return this.seconds*this.nominalFrameRate()}compareFields(s){return[this.hours-s.hours,this.minutes-s.minutes,this.seconds-s.seconds,this.frames-s.frames]}static exactFrameRate(s){return s>59&&s<60?6e4/1001:s>29&&s<30?3e4/1001:s>23&&s<24?24e3/1001:s}valueOf(){return this.frameCount()}toString(){const s=this.separator();return`${(this.hours<10?"0":"")+this.hours.toString(10)}:${(this.minutes<10?"0":"")+this.minutes.toString(10)}:${(this.seconds<10?"0":"")+this.seconds.toString(10)}${s}${(this.frames<10?"0":"")+this.frames.toString(10)}`}toSRTString(s=!1){let t=new e(this);!0===s&&(t=this.pulldown(29.97));return`${t.hours.toString(10).padStart(2,"0")}:${t.minutes.toString(10).padStart(2,"0")}:${t.seconds.toString(10).padStart(2,"0")},${t.milliseconds().toString(10).substr(2,3).padEnd(3,"0")}`}toObject(){return{hours:this.hours,minutes:this.minutes,seconds:this.seconds,frames:this.frames,frameRate:this.frameRate}}setHours(s){for(this.hours=Math.trunc(s)%24;this.hours<0;)this.hours+=24;return this.incrementIfDropFrame(),this}setMinutes(s){return this.minutes=Math.trunc(s)%60,this.setHours(this.hours+Math.trunc(s/60)),this.minutes<0&&(this.minutes+=60,this.setHours(this.hours-1)),this.incrementIfDropFrame(),this}setSeconds(s){const t=Math.trunc(s),e=s-t;return this.seconds=Math.trunc(t)%60,this.setMinutes(this.minutes+Math.trunc(s/60)),this.seconds<0&&(this.seconds+=60,this.setMinutes(this.minutes-1)),0!==e&&this.setFrames(this.getFramesFromMilliseconds(e)),this.incrementIfDropFrame(),this}setFrames(s){if(void 0===s)return this;const t=this.nominalFrameRate();return this.frames=Math.trunc(s)%t,this.setSeconds(this.seconds+Math.trunc(s/t)),this.frames<0&&(this.frames+=this.nominalFrameRate(),this.setSeconds(this.seconds-1)),this.incrementIfDropFrame(),this}nominalFrameRate(){return Math.round(this.frameRate)}frameCount(){return this.framesInHoursField()+this.framesInMinutesField()+this.framesInSecondsField()+this.frames}fractionalSeconds(){return this.seconds+this.milliseconds()}isDropFrame(){return this.frameRate>29&&this.frameRate<30||this.frameRate>59&&this.frameRate<60}add(s){const t=new e(this);return s instanceof e?this.frameRate!==s.frameRate?t.add(s.pulldown(this.frameRate)):(t.setHours(this.hours+s.hours),t.setMinutes(this.minutes+s.minutes),t.setSeconds(this.seconds+s.seconds),t.setFrames(this.frames+s.frames),t):t.add(new e(s,this.frameRate))}subtract(s){const t=new e(this);if(!(s instanceof e)){const r=new e(s,this.frameRate);return t.subtract(r)}if(this.frameRate!==s.frameRate){const e=s.pulldown(this.frameRate);return t.subtract(e)}return t.setHours(this.hours-s.hours),t.setMinutes(this.minutes-s.minutes),t.setSeconds(this.seconds-s.seconds),t.setFrames(this.frames-s.frames),t}pulldown(s,t=0){const r=new e(t,this.frameRate),i=new e(t,s),n=new e(0,s);let a=this.subtract(r).frameCount();return a*=n.nominalFrameRate(),a/=this.nominalFrameRate(),a=Math.ceil(a),n.setFieldsFromFrameCount(a),n.add(i)}pullup(s,t=0){return this.pulldown(s,t)}isBefore(s){const[t,e,r,i]=this.compareFields(s);return!(t>0)&&(t<0||!(e>0)&&(e<0||!(r>0)&&(r<0||i>0)))}}return e}));
