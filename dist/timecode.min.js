"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _iterableToArrayLimit(arr,i){var _i=arr&&(typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"]);if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var TimecodeRegex=/(\d{1,2})\D(\d{1,2})\D(\d{1,2})\D(\d{1,2})/;var secondsInOneMinute=60;var minutesInOneHour=60;var hoursInOneDay=24;function parseIntOrError(input,errorMessage){var int=parseInt(input,10);if(Number.isNaN(int))throw new TypeError(errorMessage);return int}function parseFloatOrError(input,errorMessage){var float=parseFloat(input);if(Number.isNaN(float))throw new TypeError(errorMessage);return float}var Timecode=function(){function Timecode(timecode,frameRate){_classCallCheck(this,Timecode);this.hours=0;this.minutes=0;this.seconds=0;this.frames=0;if(frameRate){this.frameRate=frameRate}else if(timecode&&timecode.frameRate){this.frameRate=timecode.frameRate}else{this.frameRate=29.97}if(timecode)this.set(timecode)}_createClass(Timecode,[{key:"set",value:function set(input){if(input instanceof Date){this.setFieldsFromDate(input)}else if(_typeof(input)==="object"){this.setFieldsFromObject(input)}else if(TimecodeRegex.test(input)){this.setFieldsFromString(input)}else if(typeof input==="number"){this.setFieldsFromFrameCount(input)}else{throw new TypeError('Invalid timecode parameter "'.concat(input,'"'))}return this}},{key:"setFieldsFromFrameCount",value:function setFieldsFromFrameCount(input){var remainingFrames=input;this.setHours(Math.trunc(remainingFrames/this.framesPerHour()));remainingFrames-=this.framesInHoursField();var tenMinutes=Math.trunc(remainingFrames/this.framesPer10Minute());remainingFrames-=this.framesPer10Minute()*tenMinutes;var singleMinutes=Math.trunc(remainingFrames/this.framesPerMinute());this.setMinutes(tenMinutes*10+singleMinutes);remainingFrames-=singleMinutes*this.framesPerMinute();this.setSeconds(Math.trunc(remainingFrames/this.nominalFrameRate()));remainingFrames-=this.framesInSecondsField();this.setFrames(remainingFrames)}},{key:"setFieldsFromString",value:function setFieldsFromString(input){var _TimecodeRegex$exec=TimecodeRegex.exec(input),_TimecodeRegex$exec2=_slicedToArray(_TimecodeRegex$exec,5),hh=_TimecodeRegex$exec2[1],mm=_TimecodeRegex$exec2[2],ss=_TimecodeRegex$exec2[3],ff=_TimecodeRegex$exec2[4];this.setHours(hh);this.setMinutes(mm);this.setSeconds(ss);this.setFrames(ff);return this}},{key:"setFieldsFromObject",value:function setFieldsFromObject(input){if(Object.prototype.hasOwnProperty.call(input,"hours"))this.setHours(input.hours);if(Object.prototype.hasOwnProperty.call(input,"minutes"))this.setMinutes(input.minutes);if(Object.prototype.hasOwnProperty.call(input,"seconds"))this.setSeconds(input.seconds);if(Object.prototype.hasOwnProperty.call(input,"frames"))this.setFrames(input.frames);return this}},{key:"setFieldsFromDate",value:function setFieldsFromDate(date){this.setHours(date.getHours());this.setMinutes(date.getMinutes());this.setSeconds(date.getSeconds());this.setFrames(Math.trunc(date.getMilliseconds()/this.nominalFrameRate()));return this}},{key:"toString",value:function toString(){var c=this.separator();var h=this.hours.toString(10).padStart(2,"0");var m=this.minutes.toString(10).padStart(2,"0");var s=this.seconds.toString(10).padStart(2,"0");var f=this.frames.toString(10).padStart(2,"0");return"".concat(h,":").concat(m,":").concat(s).concat(c).concat(f)}},{key:"toSRTString",value:function toSRTString(){var h=this.hours.toString(10).padStart(2,"0");var m=this.minutes.toString(10).padStart(2,"0");var s=this.seconds.toString(10).padStart(2,"0");var milliseconds=this.milliseconds().toString(10).substr(2,3);var mm=milliseconds.padEnd(3,"0");return"".concat(h,":").concat(m,":").concat(s,",").concat(mm)}},{key:"toObject",value:function toObject(){return{hours:this.hours,minutes:this.minutes,seconds:this.seconds,frames:this.frames,frameRate:this.frameRate}}},{key:"setHours",value:function setHours(hours){if(hours===undefined)return this;var hh=parseIntOrError(hours,"Cannot set hours to ".concat(hours));this.hours=hh%hoursInOneDay;while(this.hours<0){this.hours+=hoursInOneDay}this.incrementIfDropFrame();return this}},{key:"setMinutes",value:function setMinutes(minutes){if(minutes===undefined)return this;var mm=parseIntOrError(minutes,"Cannot set minutes to ".concat(minutes));this.minutes=mm%minutesInOneHour;this.setHours(this.hours+Math.trunc(mm/minutesInOneHour));if(this.minutes<0){this.minutes+=minutesInOneHour;this.setHours(this.hours-1)}this.incrementIfDropFrame();return this}},{key:"setSeconds",value:function setSeconds(seconds){if(seconds===undefined)return this;var ss=parseIntOrError(seconds,"Cannot set minutes to ".concat(seconds));this.seconds=ss%secondsInOneMinute;this.setMinutes(this.minutes+Math.trunc(ss/secondsInOneMinute));if(this.seconds<0){this.seconds+=secondsInOneMinute;this.setMinutes(this.minutes-1)}this.incrementIfDropFrame();return this}},{key:"setFrames",value:function setFrames(frames){if(frames===undefined)return this;var ff=parseIntOrError(frames,"Cannot set frames to ".concat(frames));var nominalFrameRate=this.nominalFrameRate();this.frames=ff%nominalFrameRate;this.setSeconds(this.seconds+Math.trunc(ff/nominalFrameRate));if(this.frames<0){this.frames+=this.nominalFrameRate();this.setSeconds(this.seconds-1)}this.incrementIfDropFrame();return this}},{key:"nominalFrameRate",value:function nominalFrameRate(){return Math.round(this.frameRate)}},{key:"exactFrameRate",value:function exactFrameRate(){if(this.frameRate>59&&this.frameRate<60){return 6e4/1001}if(this.frameRate>29&&this.frameRate<30){return 3e4/1001}if(this.frameRate>23&&this.frameRate<24){return 24e3/1001}return this.frameRate}},{key:"frameCount",value:function frameCount(){return this.framesInHoursField()+this.framesInMinutesField()+this.framesInSecondsField()+this.frames}},{key:"fractionalSeconds",value:function fractionalSeconds(){return this.seconds+this.milliseconds()}},{key:"framesPerHour",value:function framesPerHour(){return this.framesPer10Minute()*6}},{key:"framesPer10Minute",value:function framesPer10Minute(){return this.framesPerMinute()*10+this.framesToDrop()}},{key:"framesPerMinute",value:function framesPerMinute(){return 60*this.nominalFrameRate()-this.framesToDrop()}},{key:"milliseconds",value:function milliseconds(){return this.frames/this.nominalFrameRate()}},{key:"framesToDrop",value:function framesToDrop(){return this.isDropFrame()?this.nominalFrameRate()/15:0}},{key:"isDropFrame",value:function isDropFrame(){if(this.frameRate>29&&this.frameRate<30)return true;if(this.frameRate>59&&this.frameRate<60)return true;return false}},{key:"incrementIfDropFrame",value:function incrementIfDropFrame(){if(this.isDropFrame()&&this.frames<2&&this.seconds===0&&this.minutes%10!==0){this.frames+=2}}},{key:"separator",value:function separator(){return this.isDropFrame()?";":":"}},{key:"framesInHoursField",value:function framesInHoursField(){return this.hours*this.framesPerHour()}},{key:"framesInMinutesField",value:function framesInMinutesField(){return Math.trunc(this.minutes/10)*this.framesPer10Minute()+this.minutes%10*this.framesPerMinute()}},{key:"framesInSecondsField",value:function framesInSecondsField(){return this.seconds*this.nominalFrameRate()}},{key:"add",value:function add(addend){var tc=new Timecode(this);if(!(addend instanceof Timecode)){return tc.add(new Timecode(addend,this.frameRate))}if(this.frameRate!==addend.frameRate){return tc.add(addend.pulldown(this.frameRate))}tc.setHours(this.hours+addend.hours);tc.setMinutes(this.minutes+addend.minutes);tc.setSeconds(this.seconds+addend.seconds);tc.setFrames(this.frames+addend.frames);return tc}},{key:"subtract",value:function subtract(subtrahend){var tc=new Timecode(this);if(!(subtrahend instanceof Timecode)){return tc.subtract(new Timecode(subtrahend,this.frameRate))}if(this.frameRate!==subtrahend.frameRate){return tc.subtract(subtrahend.pulldown(this.frameRate))}tc.setHours(this.hours-subtrahend.hours);tc.setMinutes(this.minutes-subtrahend.minutes);tc.setSeconds(this.seconds-subtrahend.seconds);tc.setFrames(this.frames-subtrahend.frames);return tc}},{key:"pulldown",value:function pulldown(frameRate){var start=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var fps=parseFloatOrError(frameRate,"Cannot pulldown to framerate of ".concat(frameRate));var oldBase=new Timecode(start,this.frameRate);var newBase=new Timecode(start,fps);var output=new Timecode(0,fps);var outputFrames=this.subtract(oldBase).frameCount();outputFrames*=output.nominalFrameRate();outputFrames/=this.nominalFrameRate();outputFrames=Math.ceil(outputFrames);output.setFieldsFromFrameCount(outputFrames);return output.add(newBase)}},{key:"pullup",value:function pullup(frameRate,base){return this.pulldown(frameRate,base)}}]);return Timecode}();module.exports=Timecode;
